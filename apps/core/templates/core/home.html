{% extends 'base.html' %}
{% block title %}Surffers - создавайте свои подборки веб-сайтов и делитесь ими с друзьями{% endblock %}
{% load static %}
{% load contact_tags %}
{% load humanize %}

{% block content %}

{% include 'core/include/navbar.html' %}
<section class="hero home is-unselectable">
    <div class="ld">
        <div class="inside-wrapper">
            <div class="stories">
                {% for category in categories %}
                <div class="story-item">
                    <a href="{% url 'category' category.slug category.id %}">
                        <div class="card slider">
                            <div class="card-content">
                                <h1 class="title is-4 has-text-weight-bold">
                                    {{ category.title|truncatechars:33 }}
                                </h1>
                                <div class="block-home-category">
                                    <p class="title is-6 has-text-weight-normal title-body is-lowercase">
                                        {{ category.body|truncatechars:50 }}
                                    </p>
                                    <div class="media subtitle">
                                        <div class="media-left">
                                            <span class="tag is-white is-size-7 is-lowercase has-text-weight-bold">@{{ category.user.username|truncatechars:25 }}</span>
                                        </div>
                                        <div class="media-content"></div>
                                        <div class="media-right">
                                                    <span class="tag is-light is-size-7" title="Количество ссылок">
                                                        {{ category.bookmarks.all|length|intword }}
                                                    </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>
            <button class="nav-btn prev">
                <svg style="width:24px;height:24px" viewBox="0 0 24 24">
                    <path fill="#000000" d="M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z"/>
                </svg>
            </button>
            <button class="nav-btn next">
                <svg style="width:24px;height:24px" viewBox="0 0 24 24">
                    <path fill="#000000" d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"/>
                </svg>
            </button>
        </div>
    </div>
</section>
<div class="spacer"></div>
<section class="section home is-unselectable">
    <div class="container">
        <div class="columns is-centered">
            <div class="column is-2 is-unselectable is-hidden-mobile">
                <aside class="menu">
                    <p class="menu-label is-size-6">
                        Меню
                    </p>
                    <ul class="menu-list">
                        <li>
                            <a href="/">
                                <span class="is-flex is-size-5">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home icon-mr" width="16"
                                           height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none"
                                           stroke-linecap="round" stroke-linejoin="round">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                        <polyline points="5 12 3 12 12 3 21 12 19 12"/>
                                        <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7"/>
                                        <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6"/>
                                    </svg>
                                    Главная
                                </span>
                            </a>
                        </li>
                        {% if request.user.is_authenticated %}
                        <li>
                            <a href="{% url 'profile' request.user.username %}">
                                <span class="is-flex is-size-5">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user icon-mr" width="24"
                                         height="24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round"
                                         stroke-linejoin="round">
                                      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                      <circle cx="12" cy="7" r="4"/>
                                      <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2"/>
                                    </svg>
                                    Профиль
                                </span>
                            </a>
                        </li>
                        {% endif %}
                        <li>
                            <a href="{% url 'categories' %}">
                                <span class="is-flex is-size-5">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-box-multiple icon-mr"
                                         width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none"
                                         stroke-linecap="round" stroke-linejoin="round">
                                      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                      <rect x="7" y="3" width="14" height="14" rx="2"/>
                                      <path d="M17 17v2a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2v-10a2 2 0 0 1 2 -2h2"/>
                                    </svg>
                                    Категории
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'board' %}">
                                <span class="is-flex is-size-5">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-unlink icon-mr" width="44"
                                         height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none"
                                         stroke-linecap="round" stroke-linejoin="round">
                                      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                      <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5"/>
                                      <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5"/>
                                      <line x1="16" y1="21" x2="16" y2="19"/>
                                      <line x1="19" y1="16" x2="21" y2="16"/>
                                      <line x1="3" y1="8" x2="5" y2="8"/>
                                      <line x1="8" y1="3" x2="8" y2="5"/>
                                    </svg>
                                    Ссылки
                                </span>
                            </a>
                        </li>
                        <!--    <li>-->
                        <!--        <a>-->
                        <!--            <span class="is-flex is-size-5">-->
                        <!--                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-users icon-mr" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">-->
                        <!--                  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>-->
                        <!--                  <circle cx="9" cy="7" r="4" />-->
                        <!--                  <path d="M3 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />-->
                        <!--                  <path d="M16 3.13a4 4 0 0 1 0 7.75" />-->
                        <!--                  <path d="M21 21v-2a4 4 0 0 0 -3 -3.85" />-->
                        <!--                </svg>-->
                        <!--                Профили-->
                        <!--            </span>-->
                        <!--        </a>-->
                        <!--    </li>-->
                        {% if request.user.is_authenticated %}
                        <li>
                            <a href="{% url 'bookmark_favorite_lists' request.user.username %}">
                                <span class="is-flex is-size-5">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-heart icon-mr" width="44"
                                       height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none"
                                       stroke-linecap="round" stroke-linejoin="round">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                        <path d="M19.5 13.572l-7.5 7.428l-7.5 -7.428m0 0a5 5 0 1 1 7.5 -6.566a5 5 0 1 1 7.5 6.572"/>
                                    </svg>
                                    Избранное
                              </span>
                            </a>
                        </li>
                        {% endif %}
                        <li>
                            <a href="{% url 'services' %}">
                                <span class="is-flex is-size-5">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-accessible icon-mr"
                                         width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none"
                                         stroke-linecap="round" stroke-linejoin="round">
                                      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                      <circle cx="12" cy="12" r="9"/>
                                      <path d="M10 16.5l2 -3l2 3m-2 -3v-2l3 -1m-6 0l3 1"/>
                                      <circle cx="12" cy="7.5" r=".5" fill="currentColor"/>
                                    </svg>
                                    Услуги
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'about' %}">
              <span class="is-flex is-size-5">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-alert-circle icon-mr"
                   width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none"
                   stroke-linecap="round" stroke-linejoin="round">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                  <circle cx="12" cy="12" r="9"/>
                  <line x1="12" y1="8" x2="12" y2="12"/>
                  <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
                  О нас
              </span>
                            </a>
                        </li>
                    </ul>
                    <hr>
                </aside>


                <!--  Share  -->
                <div class="buttons">
                    <div class="block share has-text-centered">
                        <a class="button is-light" role="button" title="Копировать ссыылку">
                                <span class="copy-icon ">
                                    <i class="fas fa-link icon"></i>
                                </span>
                        </a>
                        <a class="button is-light sharer" href="#" id="share-em" title="Отправить на почту">
                                <span>
                                    <i aria-hidden="true" class="fa fa-envelope-o"></i>
                                </span>
                        </a>
                        <a class="button is-light sharer" href="#" id="share-vk" title="Поделиться ВКонтакте">
                                <span>
                                    <i class="fab fa-vk"></i>
                                </span>
                        </a>
                        <a class="button is-light sharer" href="#" id="share-tg" title="Поделиться в Telegram">
                                <span>
                                    <i class="fab fa-telegram"></i>
                                </span>
                        </a>
                    </div>
                </div>
                <!--  End Share  -->

                {% if request.user.is_authenticated %}
                {% else %}
                <p class="subtitle is-6">
                    Войдите, чтобы начать создавать свои подборки веб-сайтов и делиться ими с друзьями.
                </p>
                <a class="navbar-item button is-black is-rounded is-outlined" href="{% url 'account_login' %}">
                    Войти
                </a>
                <br>
                <a class="navbar-item button is-black is-rounded" href="{% url 'account_signup' %}">
                    Регистрация
                </a>

                {% endif %}
            </div>
            <div class="border-right"></div>
            <div class="column is-6">
                <h1 class="title has-text-weight-bold is-size-5 is-size-6-mobile">
                    Новые продукты, сайты, сервисы и стартапы, которые помогут в работе и учёбе 👇
                </h1>
                <hr>
                {% for bookmark in bookmarks %}
                <div class="is-flex">
                    <div class="box-home box-link">
                        <h1 class="title is-7 has-text-weight-bold is-uppercase">
                            <a href="{% url 'category'  bookmark.category.slug bookmark.category.id  %}"
                               class="has-text-black">
                                {{ bookmark.category.title|truncatechars:100 }}
                            </a>
                        </h1>
                        <p class="subtitle is-7 has-text-weight-bold">
                            <a href="{% url 'profile' bookmark.user.username %}" class="has-text-black is-lowercase">
                                @{{ bookmark.user.username|truncatechars:25 }}
                            </a>
                        </p>
                        {% if bookmark.url_icon %}
                        <h1 class="subtitle is-5">
                            <a class="icon-bookmark subtitle is-5 has-text-weight-bold is-size-6-mobile"
                               href="{{ bookmark.url }}"
                               target="_blank">
                            </a>
                            <a href="{{ bookmark.url_icon }}" class="subtitle is-5 has-text-weight-bold"
                               target="_blank">
                                {{ bookmark.title|truncatechars:40 }}
                                <span class="icon link is-size-6">
                                            <svg height="21" viewBox="0 0 21 21" width="21"
                                                 xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"
                                                                                       stroke="currentColor"
                                                                                       stroke-linecap="round"
                                                                                       stroke-linejoin="round"
                                                                                       transform="translate(3.5 6.5)"><path
                                                    d="m0 8v-2c0-1.65685425 1.34314575-3 3-3h8"/><path
                                                    d="m7.999 6 3.001-3-3.001-3"/><path d="m10.999 6 3.001-3-3.001-3"/></g></svg>
                                        </span>
                            </a>
                        </h1>
                        {% else %}
                        <h1 class="subtitle is-5">
                            <a class="icon-bookmark subtitle is-5 has-text-weight-bold is-size-6-mobile"
                               href="{{ bookmark.url }}"
                               target="_blank">
                                {{ bookmark.title|truncatechars:40 }}
                                <span class="icon link is-size-6">
                                            <svg height="21" viewBox="0 0 21 21" width="21"
                                                 xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"
                                                                                       stroke="currentColor"
                                                                                       stroke-linecap="round"
                                                                                       stroke-linejoin="round"
                                                                                       transform="translate(3.5 6.5)"><path
                                                    d="m0 8v-2c0-1.65685425 1.34314575-3 3-3h8"/><path
                                                    d="m7.999 6 3.001-3-3.001-3"/><path d="m10.999 6 3.001-3-3.001-3"/></g></svg>
                                        </span>
                            </a>
                        </h1>
                        {% endif %}


                        <p class="title is-6 has-text-weight-normal is-lowercase is-size-7-mobile">
                            {{ bookmark.body|truncatechars:150 }}
                        </p>
                        <p class="subtitle is-6 is-size-7-mobile">
                            {% for tag in bookmark.tags.all %}
                            {% if forloop.counter <= 3 %}
                            <a href="{% url 'tag_detail_url' tag.slug %}" class="has-text-info">
                                #{{ tag.name|truncatechars:25 }}
                            </a>
                            {% endif %}
                            {% endfor %}
                        </p>
                        <p class="title is-7">
                            <a href="{% url 'bookmark' bookmark.id %}" class="tag is-light hero-btn"
                               title="В избранном">
                                <span class="icon is-size-6">
                                                <i class="fa fa-heart-o" aria-hidden="true"></i>
                                            </span>
                                <span>{{ bookmark.favorite.all|length|intword }}</span>
                            </a>
                            <a href="{% url 'bookmark' bookmark.id %}" class="tag is-light hero-btn" title="Просмотров">
                                <span class="icon">
                                    <i class="fa fa-eye" aria-hidden="true"></i>
                                </span>
                                <span>{{bookmark.total_views}}</span>
                            </a>
                            <a href="{% url 'bookmark' bookmark.id %}" class="tag is-light" title="Комментариев">
                                <span class="subtitle is-7">
                                    <i class="fa fa-comment-o" aria-hidden="true"></i>
                                    {{ bookmark.comments.all|length }}
                                </span>
                            </a>

                            <a href="{% url 'bookmark' bookmark.id %}" class="tag is-light" title="Проголосовали">
                                                    <span class="icon">
                                                     <i class="fa fa-star-o" aria-hidden="true"></i>
                                                    </span>
                                <span> {{ bookmark.number_of_votes }}</span>
                            </a>
                        </p>
                    </div>
                </div>
                <hr>
                {% endfor %}


            </div>
            <div class="border-right"></div>
            <div class="column is-3 is-unselectable is-hidden-mobile">
                <aside>
                    {% include 'core/include/footer.html' %}
                </aside>
            </div>

        </div>
    </div>
</section>


<span class="toastbox" role="alert"></span>

{% endblock %}

{% block scripts %}
<script>
  var btn = $('#button');
  $(window).scroll(function () {
    if ($(window).scrollTop() > 300) {
      btn.addClass('show');
    } else {
      btn.removeClass('show');
    }
  });

  btn.on('click', function (e) {
    e.preventDefault();
    $('html, body').animate({
      scrollTop: 0
    }, '300');
  });

</script>
<script>
 $("a.icon-category-bookmark[href^='http']").each(function() {
    $(this).css({
        background: "url(http://www.google.com/s2/favicons?domain=" + this.href + ") left center no-repeat",
        "background-size": "22px", "padding-left": "30px", "pointer-events": "none", "cursor": "default"
    });
});

</script>
<script>
 $("a.icon-bookmark[href^='http']").each(function() {
    $(this).css({
        background: "url(http://www.google.com/s2/favicons?domain=" + this.href + ") left center no-repeat",
        "background-size": "22px", "padding-left": "30px"
    });
});

</script>

<script>
  document.addEventListener("DOMContentLoaded", function (event) {

    // Uses sharer.js
    //  https://ellisonleao.github.io/sharer.js/#twitter
    var url = window.location.href;
    var title = document.title;
    var subject = "Read this good article";
    var via = "yourTwitterUsername";
    //console.log( url );
    //console.log( title );

    //facebook
    $('#share-fb').attr('data-url', url).attr('data-sharer', 'facebook');
    //ok
     $('#share-ok').attr('data-url', url).attr('data-sharer', 'odnoklassniki');
    //vk
    $('#share-vk').attr('data-url', url).attr('data-sharer', 'vk');
    //reddit
    $('#share-rt').attr('data-url', url).attr('data-sharer', 'reddit');
    // pinterest
    $('#share-pn').attr('data-url', url).attr('data-title', title).attr('data-sharer', 'pinterest');
    // telegram
    $('#share-tg').attr('data-url', url).attr('data-title', title).attr('data-sharer', 'telegram');
    //twitter
    $('#share-tw').attr('data-url', url).attr('data-title', title).attr('data-via', via).attr('data-sharer',
      'twitter');
    //linkedin
    $('#share-li').attr('data-url', url).attr('data-sharer', 'linkedin');
    // email
    $('#share-em').attr('data-url', url).attr('data-title', title).attr('data-subject', subject).attr(
      'data-sharer', 'email');

    //Prevent basic click behavior
    $(".sharer button").click(function () {
      event.preventDefault();
    });


    // only show whatsapp on mobile devices
    var isMobile = false; //initiate as false
    // device detection
    if (
      /(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i
      .test(navigator.userAgent) ||
      /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i
      .test(navigator.userAgent.substr(0, 4))) {
      isMobile = true;
    }

    if (isMobile == true) {
      $("#share-wa").hide();
    }

  });

  // Copy link
  var copyToClipboard = (function () {
    var copyIcon = document.querySelector(".copy-icon");
    var toastBox = document.querySelector(".toastbox");
    var pageUrl = window.location.href;

    function isCopying(string) { // text to copy
      var textarea, result;
      try {
        textarea = document.createElement('textarea');
        textarea.setAttribute('readonly', true);
        textarea.setAttribute('contenteditable', true);
        textarea.style.position = 'fixed';
        textarea.value = string;

        document.body.appendChild(textarea);

        textarea.select();

        var range = document.createRange();
        range.selectNodeContents(textarea);

        var selectedText = window.getSelection();
        selectedText.removeAllRanges();
        selectedText.addRange(range);

        textarea.setSelectionRange(0, textarea.value.length);
        result = document.execCommand('copy');
      } catch (err) {
        console.error(err);
        result = null;
      } finally {
        document.body.removeChild(textarea);
      }
      // manual copy fallback using prompt
      if (!result) {
        result = prompt("Copy the link", string); // eslint-disable-line no-alert
        if (!result) {
          return false;
        }
      }
      return true;
    }

    function showToastBox(message) {
      toastBox.textContent = message;
      setTimeout(function () {
        toastBox.classList.add("toast-tox--active");
      }, 500)
      setTimeout(function () {
        toastBox.classList.remove("toast-tox--active");
      }, 3000)
    }

    function handleCopyIconClick() {
      copyIcon.addEventListener("click", function () {
        showToastBox(isCopying(pageUrl) ? "Ссылка успешно скопирована" : "Unable to copy");
      })
    }


    return {
      handleCopyIconClick: handleCopyIconClick
    }
  })();

  copyToClipboard.handleCopyIconClick();

</script>

<!-- Slider -->
<script>
$(document).on('click', '.tamb img', function () {
  var currentURL = $(this).attr('src');
  createLB('photo', currentURL);
});
$(document).on('click', '.tamb video', function () {
  var currentURL = $(this).attr('src');
  createLB('video', currentURL);
});
$(document).on('click', '.ld-lightbox__close, .ld-lightbox', function () {
  $('.ld-lightbox').css({ opacity: 0 });
  setTimeout(function () {
    closeLB();
  }, 300);
});

function createLB(type, url) {
  var content;
  if (type === 'photo') {
    content = '<img src=' + url + '/>';
  } else if (type === 'video') {
    content = '<video src=' + url + ' class="ld-lightbox__video" controls></video>';
  }
  var template = '<div class="ld-lightbox">' +
  '<span class="ld-lightbox__close">' +
  '<svg style="width:24px;height:24px" viewBox="0 0 24 24">' +
  '<path fill="#ffffff" d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" />' +
  '</svg>' +
  '</span> ' +
  '<div class="ld-lightbox__vl"> ' +
  '<div class="ld-lightbox__content">' +
  content +
  '</div>' +
  '<div/>' +
  '</div>';
  $('body').append(template);
}
function closeLB() {
  $('.ld-lightbox').remove();
}function StoriesSlider(config) {
  this.containerName = config.container;
  this.containerEl = document.querySelector(this.containerName);
  this.slides = null;

  this.itemOffsetSide = config.itemOffsetSide || 0;
  this.itemLeftOffset =
  config.itemLeftOffset === "undefined" ?
  this.itemOffsetSide :
  config.itemLeftOffset;
  this.itemRightOffset =
  config.itemRightOffset === "undefined" ?
  this.itemOffsetSide :
  config.itemRightOffset;
  this.minDragDistance =
  config.minDragDistance === "undefined" ? 40 : config.minDragDistance;
  this.inertionCoef = config.inertionCoef || 0.92;

  this.useSelfController = config.useIsideController ?
  config.useIsideController :
  !isNaN(+config.useIsideController) ?
  config.useIsideController :
  null;
  this.dataAttributeName = config.dataAttrName ?
  config.dataAttrName :
  "data-sts";
  this.dataAttributeValue = config.dataAttrValue ?
  config.dataAttrValue :
  "stories-slider";

  this.slidesWrapper = null;
  this.childrenArray = null;

  this.referencePoint = 0;
  this.isDrag = false;
  this.offset = 0;
  this.offsetForAnimation = 0;
  this.tran = 0;
  this.pos = 0;
  this.diff = 0.05;

  this.diffBetweenContainerAndSlidesWrapper = null;

  this.isClickPrevent = false;

  this.dir = 1; // -1 --- left, 1 --- right;

  this.leftPosition = 0;

  this.isBorder = false;

  this.isGateOpen = false;

  this.canInteract = true;

  this.setRAF = this.setRAF.bind(this);

  this.moveLeft = this.moveLeft.bind(this);

  this.moveRight = this.moveRight.bind(this);

  this._watcher = this.deb(this.watcher, this, 1000);

  this._updater = this.positionUpdaterForClick.bind(this);

  this._ls = function () {};
  this._rs = function () {};
  this._md = function () {};

  this.init();
}

StoriesSlider.prototype.getInteractPossibility = function () {
  return this.canInteract;
};

StoriesSlider.prototype.watcher = function () {
  this.setDiffBetweenContainerAndSlidesWrapper();
};

StoriesSlider.prototype.positionUpdaterForClick = function (fn) {
  if (this.isGateOpen) {
    this.offset += this.dir * 5;
    fn.call(this);
  } else {
    return false;
  }
};

StoriesSlider.prototype.deb = function (fn, ctx, d) {
  var t = true;
  return function () {
    if (t) {
      t = false;
      setTimeout(function () {
        fn.call(ctx);
        t = true;
      }, d);
    } else {
      return false;
    }
  };
};

StoriesSlider.prototype.init = function () {
  this.childrenArray = this.leadToArray(this.getSlides());
  var wrap = this.createSlidesWrapper();
  var sizes = this.getFullSizesOfSliderLine(this.childrenArray);
  this.setSizesOnSlidesWrapper(sizes);
  this.setSlidesOnSlidesWrapper(wrap, this.childrenArray);
  this.setWrapperOnContainer(this.slidesWrapper);
  this.setDiffBetweenContainerAndSlidesWrapper();
  this.setRAF();
  if (this.useSelfController) {
    this.controller();
  }
};

StoriesSlider.prototype.getSlides = function () {
  return this.containerEl.children;
};

StoriesSlider.prototype.isChildren = function () {
  return this.containerEl.childNodes.length !== 0;
};

StoriesSlider.prototype.leadToArray = function (slides) {
  return Array.prototype.slice.call(slides);
};

StoriesSlider.prototype.getContainerPaddings = function () {
  var _styles =
  this.containerEl.currentStyle || window.getComputedStyle(this.containerEl);
  return {
    pl: _styles["padding-left"],
    pt: _styles["padding-top"],
    pr: _styles["padding-right"],
    pb: _styles["padding-bottom"] };

};

StoriesSlider.prototype.getFullSizesOfSliderLine = function (slides) {
  var sizes = { w: 0, h: 0 };
  var pad = this.getContainerPaddings();
  var _pl, _pr;
  for (var i = 0, len = slides.length; i < len; i++) {
    sizes.w += slides[i].offsetWidth;
    sizes.h = Math.max(sizes.h, slides[i].offsetHeight);
    var ml = null;
    var mr = null;
    if (i === 0) {
      _pl = parseInt(pad.pl, 10);
      ml = this.itemLeftOffset + _pl + "px";
      mr = this.itemOffsetSide + "px";
    } else if (i !== 0 && i !== len - 1) {
      ml = this.itemOffsetSide + "px";
      mr = this.itemOffsetSide + "px";
    } else {
      _pr = parseInt(pad.pr, 10);
      ml = this.itemOffsetSide + "px";
      mr = this.itemRightOffset + _pr + "px";
    }
    slides[i].style.marginLeft = ml;
    slides[i].style.marginRight = mr;
  }
  sizes.w += this.getSideOffsetCorrection(slides.length) + _pr + _pl;
  sizes.topMargin = parseInt(pad.pt, 10);
  sizes.bottomMargin = parseInt(pad.pb, 10);
  return sizes;
};

StoriesSlider.prototype.getSideOffsetCorrection = function (amount) {
  return (
    this.itemOffsetSide * 2 * (amount - 1) +
    this.itemLeftOffset +
    this.itemRightOffset);

};

StoriesSlider.prototype.createSlidesWrapper = function () {
  this.slidesWrapper = document.createElement("div");
  this.slidesWrapper.className = "sts-wrapper";
  this.slidesWrapper.setAttribute(
  this.dataAttributeName,
  this.dataAttributeValue);

  var self = this;
  return function (elements) {
    elements.forEach(function (el) {
      self.slidesWrapper.appendChild(el);
    });
  };
};

StoriesSlider.prototype.setSizesOnSlidesWrapper = function (sizes) {
  this.slidesWrapper.style.width = sizes.w + "px";
  this.slidesWrapper.style.height = sizes.h + "px";
  this.slidesWrapper.style.marginTop = sizes.topMargin + "px";
  this.slidesWrapper.style.marginBottom = sizes.bottomMargin + "px";
  this.containerEl.style.height =
  sizes.h + sizes.topMargin + sizes.bottomMargin + "px";
};

StoriesSlider.prototype.setSlidesOnSlidesWrapper = function (
wrapperSeter,
slides)
{
  wrapperSeter(slides);
};

StoriesSlider.prototype.setWrapperOnContainer = function (wrap) {
  this.containerEl.appendChild(wrap);
};

StoriesSlider.prototype.setDiffBetweenContainerAndSlidesWrapper = function () {
  this.diffBetweenContainerAndSlidesWrapper =
  this.containerEl.clientWidth - this.slidesWrapper.clientWidth;
};

StoriesSlider.prototype.checkBorder = function (fn) {
  if (this.isBorder) {
    return false;
  } else {
    fn.call(this);
    this.isBorder = true;
  }
};
StoriesSlider.prototype.getLeftPosition = function () {
  return (
    this.slidesWrapper.getBoundingClientRect().left -
    this.containerEl.getBoundingClientRect().left);

};

StoriesSlider.prototype.setRAF = function () {
  this._watcher();

  this._updater(function () {
    this.offsetForAnimation =
    Math.abs(this.offset) <= this.minDragDistance ?
    this.offset :
    this.offset / 25;
    this.pos = this.tran + parseInt(this.offset.toFixed(3), 10);
  });

  this.leftPosition = this.getLeftPosition();

  this.dir = this.offset >= 0 ? 1 : -1;

  if (!this.isDrag && this.tran !== 0) {
    this.tran += this.offsetForAnimation *= this.inertionCoef;
    this.pos = this.tran;
  }

  if (this.leftPosition >= 0 && this.diffBetweenContainerAndSlidesWrapper < 0) {
    if (!!this._ls) {
      this.isBorder = false;
    } else {
      this.isBorder = true;
    }
    this.checkBorder(function () {
      this._ls();
    });
  }

  if (this.leftPosition > 0 && this.dir > 0) {
    this.isBorder = false;
    this.isGateOpen = false;
    this.isDrag = false;
    this.tran = 0;
    this.pos = 0;
    this.offset = 0;
    this.offsetForAnimation = 0;
    this.checkBorder(function () {
      this._ls();
    });
  }
  if (
  this.diffBetweenContainerAndSlidesWrapper >= this.leftPosition &&
  this.dir < 0)
  {
    this.isBorder = false;
    this.isGateOpen = false;
    this.isDrag = false;
    this.tran = this.leftPosition;
    this.pos = this.leftPosition;
    this.offset = 0;
    this.offsetForAnimation = 0;
    this.checkBorder(function () {
      this._rs();
    });
  }
  if (
  this.diffBetweenContainerAndSlidesWrapper < this.leftPosition &&
  this.leftPosition < 0)
  {
    this.checkBorder(function () {
      this._md();
    });
  }
  this.moveContainer(this.pos);
  requestAnimationFrame(this.setRAF);
};

StoriesSlider.prototype.isLeftSide = function (callback) {
  this._ls = callback;
};

StoriesSlider.prototype.isRightSide = function (callback) {
  this._rs = callback;
};

StoriesSlider.prototype.isMedium = function (callback) {
  this._md = callback;
};

StoriesSlider.prototype.moveContainer = function (offset) {
  this.slidesWrapper.style.transform = "translate3d(" + offset + "px, 0, 0)";
};

StoriesSlider.prototype.getEvent = function (e) {
  return !!e.targetTouches ? e.targetTouches[0].clientX : e.clientX;
};

StoriesSlider.prototype.down = function (e) {
  if (this.isClickPrevent) {
    e.preventDefault();
    e.stopPropagation();
  }
  this.canInteract = true;
  this.isDrag = true;
  this.referencePoint = this.getEvent(e);
};

StoriesSlider.prototype.up = function (e) {
  this.isClickPrevent = false;
  //e.preventDefault();
  //e.stopPropagation();
  this.isDrag = false;
  this.tran = this.pos;
};

StoriesSlider.prototype.move = function (e) {
  this.isClickPrevent = true;
  e.preventDefault();
  e.stopPropagation();
  this.canInteract = false;
  this.isBorder = false;
  if (this.isDrag && !this.isGateOpen) {
    this.offset = this.getEvent(e) - this.referencePoint;
    this.offsetForAnimation =
    Math.abs(this.offset) <= this.minDragDistance ?
    this.offset :
    this.offset / 8;
    this.pos = this.tran + parseInt(this.offset.toFixed(3), 10);
  }
};

StoriesSlider.prototype.setSliderMotion = function (direction) {
  if (this.isGateOpen) {
    return false;
  }
  var self = this;
  this.offset = 0;
  this.isBorder = false;
  this.dir = direction;
  this.isGateOpen = true;
  this.isDrag = true;
  setTimeout(function () {
    self.isGateOpen = false;
    self.isDrag = false;
    self.tran = self.pos;
  }, 500);
};

StoriesSlider.prototype.moveLeft = function () {
  this.setSliderMotion(1);
};

StoriesSlider.prototype.moveRight = function () {
  this.setSliderMotion(-1);
};

StoriesSlider.prototype.controller = function (wrap) {
  var self = this;

  this.slidesWrapper.addEventListener("mousedown", function (e) {
    self.down(e);
  });

  this.slidesWrapper.addEventListener("mouseup", function (e) {
    self.up(e);
  });

  this.slidesWrapper.addEventListener("mousemove", function (e) {
    self.move(e);
  });

  this.slidesWrapper.addEventListener("mouseleave", function (e) {
    self.up(e);
  });
  /***************************************************************/
  this.slidesWrapper.addEventListener("touchstart", function (e) {
    self.down(e);
  });

  this.slidesWrapper.addEventListener("touchmove", function (e) {
    self.move(e);
  });

  this.slidesWrapper.addEventListener("touchend", function (e) {
    self.up(e);
  });
};

var slider = new StoriesSlider({
  container: ".stories",
  itemLeftOffset: 5,
  itemRightOffset: 5,
  itemOffsetSide: 5,
  minDragDistance: 10,
  useIsideController: false,
  inertionCoef: 0.93 });


var el = $("[data-sts]");

el.on("mousedown touchstart", function (e) {
  slider.down(e);
});
el.on("mousemove touchmove", function (e) {
  slider.move(e);
});
el.on("mouseup", function (e) {
  slider.up(e);
});
el.on("mouseleave touchend", function (e) {
  slider.up(e);
});

function showButtons() {
  var prev = document.querySelector(".prev");
  var next = document.querySelector(".next");
  return function (type) {
    if (type === "left") {
      next.classList.add("nav-btn--active");
      prev.classList.remove("nav-btn--active");
    }
    if (type === "right") {
      next.classList.remove("nav-btn--active");
      prev.classList.add("nav-btn--active");
    }
    if (type === "medium") {
      next.classList.add("nav-btn--active");
      prev.classList.add("nav-btn--active");
    }
  };
}

var setActionsState = showButtons();

slider.isLeftSide(function () {
  setActionsState("left");
});

slider.isRightSide(function () {
  setActionsState("right");
});

slider.isMedium(function () {
  setActionsState("medium");
});

var prev = document.querySelector(".prev");
var next = document.querySelector(".next");

prev.addEventListener("click", function () {
  slider.moveLeft();
});

next.addEventListener("click", function () {
  slider.moveRight();
});

//console.log( a ? a : !isNaN(+a) ? a : null );

$(document).on("click", "img", function (e) {
  if ($(this).attr("src") && slider.getInteractPossibility()) {
    createLB("photo", $(this).attr("src"));
  }
});

$(document).on("click", ".ld-lightbox__close, .ld-lightbox", function () {
  $(".ld-lightbox").css({ opacity: 0 });
  setTimeout(function () {
    closeLB();
  }, 300);
});

</script>
{% endblock %}






